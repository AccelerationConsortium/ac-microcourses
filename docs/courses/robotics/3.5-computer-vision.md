
(3.5-orientation)=
# ðŸ§© 3.5 Computer Vision

```{contents}
:depth: 3
```

## ðŸ”° Tutorial

In this module, you will develop software to:
1. Demonstrate spatial referencing and ID lookup by using **OpenCV** and **AprilTags**
2. Use a motorized microscope and **OpenCV** to search for regions of interest (ROI) in a sample

### OpenCV

First, you will utilize **OpenCV**, a powerful computer vision library, to preprocess images, detect objects, and perform real-time computer vision tasks. **OpenCV** is widely used for various computer vision applications, including image filtering, object tracking, and edge detection.

#### Bill of Materials

- [OpenCV](https://pypi.org/project/opencv-python/) (for Python installation: `pip install opencv-python`)
- [AprilTag Python Library](https://pypi.org/project/apriltag/)
- [Motorized Microscope]
- [Raspberry Pi Camera Module](https://www.raspberrypi.org/products/camera-module-v2/)
- [USB-A to micro USB-B cable]

#### Demo

âœ… Read the [OpenCV Documentation](https://docs.opencv.org/4.x/)

âœ… Watch [Introduction to OpenCV](https://www.youtube.com/watch?v=oXlwWbU8l2o)

In this task, you will use **OpenCV** to perform image preprocessing, such as applying a Gaussian blur, detecting edges, and identifying regions of interest (ROI).

```python
import cv2
import numpy as np

# Load an image
img = cv2.imread('sample_image.jpg')

# Apply Gaussian Blur
blurred = cv2.GaussianBlur(img, (5, 5), 0)

# Edge Detection
edges = cv2.Canny(blurred, 100, 200)

cv2.imshow('Edges', edges)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

The above code will help you preprocess the image to smoothen it and then detect edges. This is the first step before applying any region of interest search.

---

### AprilTags

Next, you will utilize **AprilTags**, a popular fiducial marker system for reliable and robust spatial referencing and object identification. AprilTags are often used in robotics for locating objects and navigating environments.

#### Bill of Materials

- [AprilTags Python Library](https://pypi.org/project/apriltag/)
- [AprilTags Documentation](https://april.eecs.umich.edu/software/apriltag.html)
- [Raspberry Pi Camera Module](https://www.raspberrypi.org/products/camera-module-v2/)
- [Motorized Microscope]
#### Demo

âœ… Watch [Vision Programming with AprilTags](https://youtu.be/TG9KAa2EGzQ)

The following code demonstrates how to use **AprilTags** for spatial referencing by detecting tags and performing ID lookup.

```python
import apriltag
import cv2

# Load an image with AprilTags
img = cv2.imread('apriltag_image.jpg')
gray_image = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# Initialize AprilTag detector
detector = apriltag.Detector()

# Detect tags
tags = detector.detect(gray_image)

# Display tag information
for tag in tags:
    print(f"Detected tag ID: {tag.tag_id}")
    cv2.rectangle(img, 
                  (int(tag.corners[0][0]), int(tag.corners[0][1])), 
                  (int(tag.corners[2][0]), int(tag.corners[2][1])), 
                  (0, 255, 0), 2)

cv2.imshow('AprilTag Detected', img)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

In this demo, you will detect **AprilTags** in an image and draw bounding boxes around them. You can then use the tag ID for further referencing tasks.

---

### Motorized Microscope and OpenCV

After detecting regions of interest (ROI) using **OpenCV** and **AprilTags**, you will integrate a motorized microscope. The microscope will move automatically based on the ROI found in the image, providing fine control and automation for analyzing samples.

#### Demo

âœ… Watch [Controlling a Motorized Microscope](https://youtu.be/fHZSsAKThW4)

In this task, you will automate the movement of a motorized microscope using **OpenCV**-detected ROIs. Below is a conceptual pseudo-code for moving the microscope:

```python
def move_microscope_to_roi(roi):
    # Command to move the motorized microscope to ROI based on coordinates
    microscope.move_to(roi['x'], roi['y'])

# Sample ROI detected using OpenCV (this would be dynamically detected)
roi = {'x': 150, 'y': 200}

# Move the microscope to the detected ROI
move_microscope_to_roi(roi)
```

You can integrate the motorized microscope with your **OpenCV** detection pipeline, enabling real-time analysis and precise control.

---

## ðŸš€ Quiz

::::{tab-set}
:sync-group: category

:::{tab-item} Sp/Su 2024
:sync: sp2024

[Quiz URL]
:::

::::

---

## ðŸ“„ Assignment

Create a script that uses **OpenCV** and **AprilTags** to detect regions of interest in a sample and control a motorized microscope to move to those regions.

âœ… First, preprocess the sample image using **OpenCV** (apply filters and detect edges).
âœ… Then, detect and extract **AprilTags** for spatial referencing.
âœ… Finally, automate the movement of the motorized microscope to the detected regions of interest.

Example tasks:
1. Write a script to process an image and identify ROIs using **OpenCV**.
2. Detect **AprilTags** and use the tag ID for tracking and referencing.
3. Integrate a motorized microscope to search and focus on regions of interest.

