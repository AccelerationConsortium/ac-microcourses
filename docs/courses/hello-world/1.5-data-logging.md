# ï¿½ï¿½ 1.5 Logging Data

```{contents}
:depth: 3
```

## ðŸ”° Tutorial

```{warning}
As a temporary workaround to the issue described in https://github.com/orgs/micropython/discussions/15112, add [`urequests_2.py`](https://github.com/AccelerationConsortium/ac-microcourses/blob/main/docs/courses/hello-world/urequests_2.py) to your microcontroller, and change `import urequests` to `import urequests_2 as urequests` in the code below.
```

In this tutorial, you will learn how to upload data to a MongoDB database from a microcontroller and read data from a database using Python with PyMongo.

<img src="../../_static/mongodb.png" width=80%>

*MongoDB database interface for a light-mixing database instance.*

### FAIR Data

Chemistry and materials research data is precious. By making your data **F**indable, **A**ccessible, **I**nteroperable, and **R**eusable ([FAIR](https://www.go-fair.org/fair-principles/)), you can maximize the impact of your research. Here are two conceptual examples of what FAIR data might look like in the physical sciences:

![FAIR data in materials science](./images/fair-data-materials-science.png)

*Defining FAIR Data in materials science. Reproduced from https://doi.org/10.1557/s43577-023-00498-4*

### Data Logging Architecture

For storing our data, we will be using [MongoDB](https://www.mongodb.com/). The architecture consists of two main components:

1. **Microcontroller Data Upload**: The microcontroller (Pico W) collects data and sends it to the orchestrator
2. **Orchestrator Data Management**: The orchestrator, running a full Python environment, uses PyMongo to interact with MongoDB for data storage and retrieval

This setup allows us to leverage the full capabilities of PyMongo in the orchestrator while keeping the microcontroller code simple and focused on data collection.

### Setting Up the Data Pipeline

âœ… Copy the following code into a new file on the microcontroller called `send_data.py`. Note that you will need [`netman.py`](https://github.com/sparks-baird/self-driving-lab-demo/blob/main/src/public_mqtt_sdl_demo/lib/netman.py) and a file named `my_secrets.py` with your WiFi credentials and orchestrator endpoint details.

```python
from netman import connectWiFi
import urequests_2 as urequests  # Using urequests_2 as per warning
from my_secrets import SSID, PASSWORD, ORCHESTRATOR_URL

# Connect to WiFi
connectWiFi(SSID, PASSWORD, country="US")

# Prepare sample data
data = {
    "temperature": 25.5,
    "humidity": 60,
    "timestamp": "2024-03-20T10:00:00"
}

# Send data to orchestrator
response = urequests.post(ORCHESTRATOR_URL, json=data)
print(f"Response status: {response.status_code}")
response.close()
```

### Working with MongoDB in the Orchestrator

The orchestrator uses PyMongo to interact with MongoDB. Here's a basic example of how to connect and write data:

```python
from pymongo import MongoClient

# Connect to MongoDB
client = MongoClient('mongodb://localhost:27017/')
db = client['your_database']
collection = db['your_collection']

# Insert data
data = {
    "temperature": 25.5,
    "humidity": 60,
    "timestamp": "2024-03-20T10:00:00"
}
result = collection.insert_one(data)
```

For more detailed examples of reading and writing data using PyMongo, including querying, updating, and managing collections, please refer to our [PyMongo tutorial notebook](./1.5.1-pymongo.html).

```{tip}
When working with MongoDB in Python, it's recommended to use connection pooling and proper error handling. See the [PyMongo documentation](https://pymongo.readthedocs.io/en/stable/examples/index.html) for best practices.
```

### Reading Material

âœ… Read [Community action on FAIR data will fuel a revolution in materials research](https://doi.org/10.1557/s43577-023-00498-4)

âœ… Watch [the following video](https://youtu.be/cdSENQPsAiI?si=KkwmGzoQmQP-CsQo) about materials databases:

[Watch the video about materials databases on YouTube](https://www.youtube.com/watch?v=cdSENQPsAiI)

### Additional Resources
- FAIR data principles [website](https://www.go-fair.org/fair-principles/) and [manuscript](https://doi.org/10.1038/sdata.2016.18)
- [MongoDB: What is NoSQL?](https://www.mongodb.com/nosql-explained)
- [MongoDB Getting Started Interactive Tutorial](https://www.mongodb.com/docs/manual/tutorial/getting-started/)
- [PyMongo Documentation](https://pymongo.readthedocs.io/)
- [@sgbaird's list of materials databases](https://github.com/stars/sgbaird/lists/materials-databases)
- Misc. [`awesome-materials-informatics`](https://github.com/tilde-lab/awesome-materials-informatics)
- [`awesome-self-driving-labs` research data management section](https://github.com/AccelerationConsortium/awesome-self-driving-labs#research-data-management)

```{tip}
For larger files like images, consider using [Amazon S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html) and storing only the URI in MongoDB. This approach is more efficient for managing large binary data while maintaining the relationship between your experimental data and associated files.
```

## ðŸš€ Quiz

::::{tab-set}
:sync-group: category

:::{tab-item} W 2024
:sync: w2024

https://q.utoronto.ca/courses/350933/assignments/1274181?display=full_width
:::

:::{tab-item} Sp/Su 2024
:sync: sp2024

https://q.utoronto.ca/courses/351407/assignments/1286934?display=full_width
:::

::::

## ðŸ“„ Assignment

::::{tab-set}
:sync-group: category

:::{tab-item} W 2024
:sync: w2024

https://q.utoronto.ca/courses/350933/assignments/1274182?display=full_width
:::

:::{tab-item} Sp/Su 2024
:sync: sp2024

https://q.utoronto.ca/courses/351407/assignments/1286935?display=full_width
:::

::::
